% compute the camera parameters
aspect_ratio = 16/9;
sensor_width_px = 1280;
sensor_height_px = 720;
sensor_width_mm = 32;
sensor_height_mm = sensor_width_mm / aspect_ratio;
px_per_mm = sensor_width_px / sensor_width_mm;

focal_length_mm = 35;
focal_length_px = focal_length_mm * px_per_mm;

K = [focal_length_px, 0, sensor_width_px / 2;
      0, focal_length_px, sensor_height_px / 2;
      0, 0, 1];

addpath C:\Users\Daniela\Documents\3D_Recon\TOOLBOX_calib
T_0 = [0.0, -9.0, 2.0];
T_1 = [4.5, -7.8, 2.0];
T_2 = [7.8, -4.5, 2.0];
T_3 = [9.0, 0.0, 2.0];
T_4 = [7.8, 4.5, 2.0];
T_5 = [4.5, 7.8, 2.0];
T_6 = [0.0, 9.0, 2.0];
T_7 = [-4.5, 7.8, 2.0];
T_8 = [-7.8, 4.5, 2.0];
T_9 = [-9, 0.0, 2.0];
T_10 = [-7.8, -4.5, 2.0];
T_11 = [-4.5, -7.8, 2.0];
T_12 = [0.0, -7.5, 5.0];
T_13 = [3.75, -6.5, 5.0];
T_14 = [6.5, -3.75, 5.0];
T_15 = [7.5, 0.0, 5.0];
T_16 = [6.5, 3.75, 5.0];
T_17 = [3.75, 6.5, 5.0];
T_18 = [0.0, 7.5, 5.0];
T_19 = [-3.75, 6.5, 5.0];
T_20 = [-6.5, 3.75, 5.0];
T_21 = [-7.5, 0.0, 5.0];
T_22 = [-6.5, -3.75, 5.0];
T_23 = [-3.75, -6.5, 5.0];
T_24 = [0.0, -6.0, 6.7];
T_25 = [3.0, -5.2, 6.7];
T_26 = [5.2, -3.0, 6.7];
T_27 = [6.0, 0.0, 6.7];
T_28 = [5.2, 3.0, 6.7];
T_29 = [3.0, 5.2, 6.7];
T_30 = [0.0, 6.0, 6.7];
T_31 = [-3.0, 5.2, 6.7];
T_32 = [-5.2, 3.0, 6.7];
T_33 = [-6.0, 0.0, 6.7];
T_34 = [-5.2, -3.0, 6.7];
T_35 = [-3.0, -5.2, 6.7];
  
om_0 = [80.0, 0.0, 0.0];
om_1 = [80.0, 0.0, 30.0];
om_2 = [80.0, 0.0, 60.0];
om_3 = [80.0, 0.0, 90.0];
om_4 = [80.0, 0.0, 120.0];
om_5 = [80.0, 0.0, 150.0];
om_6 = [80.0, 0.0, 180.0];
om_7 = [80.0, 0.0, 210.0];
om_8 = [80.0, 0.0, 240.0];
om_9 = [80.0, 0.0, 270.0];
om_10 = [80.0, 0.0, 300.0];
om_11 = [80.0, 0.0, 330.0];
om_12 = [60.0, 0.0, 0.0];
om_13 = [60.0, 0.0, 30.0];
om_14 = [60.0, 0.0, 60.0];
om_15 = [60.0, 0.0, 90.0];
om_16 = [60.0, 0.0, 120.0];
om_17 = [60.0, 0.0, 150.0];
om_18 = [60.0, 0.0, 180.0];
om_19 = [60.0, 0.0, 210.0];
om_20 = [60.0, 0.0, 240.0];
om_21 = [60.0, 0.0, 270.0];
om_22 = [60.0, 0.0, 300.0];
om_23 = [60.0, 0.0, 330.0];
om_24 = [45.0, 0.0, 0.0];
om_25 = [45.0, 0.0, 30.0];
om_26 = [45.0, 0.0, 60.0];
om_27 = [45.0, 0.0, 90.0];
om_28 = [45.0, 0.0, 120.0];
om_29 = [45.0, 0.0, 150.0];
om_30 = [45.0, 0.0, 180.0];
om_31 = [45.0, 0.0, 210.0];
om_32 = [45.0, 0.0, 240.0];
om_33 = [45.0, 0.0, 270.0];
om_34 = [45.0, 0.0, 300.0];
om_35 = [45.0, 0.0, 330.0];

if ~exist('txt/', 'file')
    mkdir ('txt/');
end
R_cam2cv = [1, 0, 0; 0, -1, 0; 0, 0, -1];
for i = 0 : 35
    fid = fopen(sprintf('txt/%04d.txt', i), 'wt');
    om = eval(['om_', num2str(i)]);
    R = rodrigues(om / 180.0 * pi);
    T = eval(['T_' num2str(i)])';
    R_world2cam = R';
    T_world2cam = -R' * T;
    R_world2cv = R_cam2cv * R_world2cam;
    T_world2cv = R_cam2cv * T_world2cam;
    P = zeros(3, 4);
    P(:, 1 : 3) = K * R_world2cv;
    P(:, 4) = K * T_world2cv;
    fprintf(fid, 'CONTOUR\n');
    fprintf(fid, '%.4f %.4f %.4f %.4f\n%.4f %.4f %.4f %.4f\n%.4f %.4f %.4f %.4f',...
            P(1, 1), P(1, 2), P(1, 3), P(1, 4),...
            P(2, 1), P(2, 2), P(2, 3), P(2, 4),...
            P(3, 1), P(3, 2), P(3, 3), P(3, 4));
end

